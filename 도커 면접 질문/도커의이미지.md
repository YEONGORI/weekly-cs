### 도커의 이미지가 무엇인가요?

컨테이너를 정의하는 템플릿입니다. 도커 이미지는 컨테이너의 파일 시스템을 갖고 있기 때문에 dependencies, configuration, scripts, binaries 등 어플리케이션 구동에 필요한 모든 정보를 갖고 있습니다.

### 이미지의 구조를 알고있나요?

이미지는 계층 구조로 이루어져 있습니다.

### 계층 구조가 어떻게 가능한가요?

유니온 마운트 파일 시스템을 사용해서 계층식 적층 구조를 구현합니다. 유니온 마운트란, 하나의 디렉토리 지점에 여러개의 디렉토리를 마운트해 하나의 통합된 디렉토리처럼 보이게 하는 기술을 의미합니다.

이미지를 풀 받을 때 이미지의 각 Layer들은 독립적으로 저장되었다가. 컨테이너가 실행될 때 이 레이어들을 순서대로 쌓아 올려서 특정 위치해 마운트하는 것입니다. 

도커는 이 유니온 마운트를 지원하는 다양한 스토리지 드라이버를 지원하고 있는데, 제가 주로 사용한 OS인 amazon linux2에는 유니온 마운트 구현체 overlay2를 기본 스토리지 드라이버로 사용하고 있습니다.


### 만약 컨테이너를 실행한 후에 아래 계층 레이어의 파일을 삭제하면 이미지의 불변은 지켜지지 않는 것 아닌가요?

그렇지 않습니다. 컨테이너가 실행되면 이미지 레이어위에 **컨테이너 레이어**가 추가됩니다. 어플리케이션 실행 중 발생한 모든 변경사항은 최상위 레이어인 **컨테이너 레이어**에 기록되고 그 아래에 있는 레이어들에는 어떠한 변경도 일어나지 않습니다.

아래 계층 레이어의 파일을 삭제하는 것은 유니온 마운트가 최상위 레이어에서 해당 파일을 가려서 삭제된 것처럼 보이는 것입니다.






>참고하면 좋은 자료
https://velog.io/@yeongori/Docker-2
https://www.44bits.io/ko/post/how-docker-image-work